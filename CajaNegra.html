<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Guía Interactiva: Pruebas de Caja Negra + Cypress (Módulo Venta de Cursos)</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Highlight.js for code syntax -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #6366f1;
      --secondary-color: #8b5cf6;
      --accent-color: #06b6d4;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --dark-bg: #0f172a;
      --card-bg: #1e293b;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --border-color: #334155;
    }

    body { 
      scroll-behavior: smooth;
      background: linear-gradient(135deg, var(--dark-bg) 0%, #1e293b 100%);
      color: var(--text-primary) !important;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
    }

    /* Asegurar texto blanco en párrafos y títulos */
    p, h1, h2, h3, h4, h5, h6, span, div, li {
      color: var(--text-primary) !important;
    }

    /* Excepciones para elementos que necesitan mantener su color original */
    .table, .table *, .badge, .badge *, .btn, .btn * {
      color: initial !important;
    }

    /* Color específico para texto secundario */
    .text-muted {
      color: var(--text-secondary) !important;
    }

    /* Color para código inline */
    code {
      color: var(--accent-color) !important;
      background: rgba(6, 182, 212, 0.1) !important;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Navigation */
    .navbar {
      background: rgba(15, 23, 42, 0.95) !important;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .navbar-brand {
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-link {
      color: var(--text-secondary) !important;
      transition: all 0.3s ease;
      border-radius: 8px;
      margin: 0 4px;
    }

    .nav-link:hover {
      color: var(--primary-color) !important;
      background: rgba(99, 102, 241, 0.1);
      transform: translateY(-1px);
    }

    /* Cards and containers */
    .container {
      max-width: 1200px;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      border-color: var(--primary-color);
    }

    /* Headers */
    .display-6 {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      margin-bottom: 1rem;
    }

    .section-title {
      scroll-margin-top: 80px;
      color: var(--text-primary) !important;
      font-weight: 700;
      position: relative;
      padding-left: 20px;
    }

    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 24px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: 2px;
    }

    /* Asegurar que los h6 también sean blancos */
    h6 {
      color: var(--text-primary) !important;
    }

    /* Code blocks */
    pre { 
      position: relative;
      background: #0d1117 !important;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin: 1rem 0;
    }

    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 10;
      background: var(--primary-color);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .copy-btn:hover {
      background: var(--secondary-color);
      transform: scale(1.05);
    }

    .code-block { 
      background: #0d1117;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding-top: 2.5rem;
      position: relative;
      overflow: hidden;
    }

    .code-block::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      opacity: 0.1;
    }

    /* Tables */
    .table {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .table-dark {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
    }

    .table-striped > tbody > tr:nth-of-type(odd) > td {
      background: rgba(99, 102, 241, 0.05);
      color: var(--text-primary) !important;
    }

    .table-striped > tbody > tr:nth-of-type(even) > td {
      background: var(--card-bg);
      color: var(--text-primary) !important;
    }

    .table tbody td {
      color: var(--text-primary) !important;
    }

    /* Badges */
    .badge-step { 
      font-size: .9rem;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
    }

    .bg-primary { background: var(--primary-color) !important; }
    .bg-secondary { background: var(--secondary-color) !important; }

    /* Accordion */
    .accordion-item {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      margin-bottom: 8px;
      border-radius: 12px;
      overflow: hidden;
    }

    .accordion-button {
      background: var(--card-bg);
      color: var(--text-primary) !important;
      border: none;
      font-weight: 600;
      padding: 1.25rem;
    }

    .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white !important;
    }

    .accordion-button::after {
      filter: invert(1);
    }

    .accordion-body {
      background: var(--card-bg);
      color: var(--text-primary) !important;
    }

    .accordion-body ul li, .accordion-body ol li {
      color: var(--text-primary) !important;
    }

    /* List groups */
    .list-group-item {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      color: var(--text-primary) !important;
      margin-bottom: 4px;
      border-radius: 8px !important;
      transition: all 0.3s ease;
    }

    .list-group-item:hover {
      background: rgba(99, 102, 241, 0.1);
      border-color: var(--primary-color);
      transform: translateX(8px);
    }

    .list-group-item a {
      color: var(--text-primary) !important;
      text-decoration: none;
    }

    /* Buttons */
    .btn-outline-light {
      border-color: var(--border-color);
      color: var(--text-primary) !important;
    }

    .btn-outline-light:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white !important;
    }

    .btn-outline-primary {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white !important;
    }

    .btn-outline-secondary {
      color: var(--text-primary) !important;
    }

    .btn-outline-secondary:hover {
      color: white !important;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fadeInUp 0.6s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .display-6 {
        font-size: 1.75rem;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--dark-bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary-color);
    }

    /* Footer */
    footer {
      background: var(--card-bg);
      border-top: 1px solid var(--border-color);
      margin-top: 4rem;
    }

    /* Icon styles */
    .section-icon {
      color: var(--primary-color);
      margin-right: 12px;
      font-size: 1.2em;
    }

    .feature-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      height: 100%;
    }

    .feature-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(99, 102, 241, 0.1);
      border-color: var(--primary-color);
    }

    .feature-icon {
      font-size: 3rem;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-root-margin="0px 0px -40%" tabindex="0">

<nav id="mainNav" class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#inicio">
      <i class="fas fa-rocket me-2"></i>Guía de Pruebas E2E con Cypress
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="#indice"><i class="fas fa-list me-1"></i>Índice</a></li>
        <li class="nav-item"><a class="nav-link" href="#cypress-que-es"><i class="fas fa-info-circle me-1"></i>¿Qué es Cypress?</a></li>
        <li class="nav-item"><a class="nav-link" href="#esquema-caja-negra"><i class="fas fa-cube me-1"></i>Esquema Caja Negra</a></li>
        <li class="nav-item"><a class="nav-link" href="#informe-paso-a-paso"><i class="fas fa-clipboard-list me-1"></i>Informe Paso a Paso</a></li>
        <li class="nav-item"><a class="nav-link" href="#instalacion"><i class="fas fa-download me-1"></i>Instalación</a></li>
        <li class="nav-item"><a class="nav-link" href="#primer-test"><i class="fas fa-code me-1"></i>Primer Test</a></li>
        <li class="nav-item"><a class="nav-link" href="#mas-casos"><i class="fas fa-tasks me-1"></i>Más Casos</a></li>
        <li class="nav-item"><a class="nav-link" href="#reportes"><i class="fas fa-chart-bar me-1"></i>Reportes</a></li>
      </ul>
      <a class="btn btn-outline-light btn-sm" href="#inicio">
        <i class="fas fa-arrow-up me-1"></i>Arriba
      </a>
    </div>
  </div>
</nav>

<main class="container animate-fade-in" id="inicio" style="padding-top: 5rem;">
  <header class="my-5 text-center">
    <h1 class="display-6">
      <i class="fas fa-vial section-icon"></i>
      Guía Interactiva: Prueba de Caja Negra y Automatización con Cypress
    </h1>
    <p class="text-muted fs-5 mb-4">
      Proyecto: <strong class="text-primary">Módulo Venta de Cursos</strong> (Software Admin MGA)
    </p>
    <div class="row justify-content-center">
      <div class="col-md-4 mb-3">
        <div class="feature-card">
          <i class="fas fa-robot feature-icon"></i>
          <h5>Automatización</h5>
          <p class="text-muted">Pruebas E2E automatizadas con Cypress</p>
        </div>
      </div>
      <div class="col-md-4 mb-3">
        <div class="feature-card">
          <i class="fas fa-shield-alt feature-icon"></i>
          <h5>Caja Negra</h5>
          <p class="text-muted">Validación funcional sin analizar código interno</p>
        </div>
      </div>
      <div class="col-md-4 mb-3">
        <div class="feature-card">
          <i class="fas fa-chart-line feature-icon"></i>
          <h5>Reportes</h5>
          <p class="text-muted">Evidencia automática y documentación</p>
        </div>
      </div>
    </div>
  </header>

  <!-- Índice -->
  <section id="indice" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-list section-icon"></i>
        Índice principal
      </h2>
      <div class="row">
        <div class="col-lg-6">
          <ol class="list-group list-group-numbered">
            <li class="list-group-item"><a href="#cypress-que-es">¿Qué es Cypress? (definición y características)</a></li>
            <li class="list-group-item"><a href="#esquema-caja-negra">Esquema de Prueba de Caja Negra (objetivo, criterios, casos)</a></li>
            <li class="list-group-item"><a href="#informe-paso-a-paso">Informe del Proceso Paso a Paso (Fases 1 a 4)</a></li>
            <li class="list-group-item"><a href="#instalacion">Instalación Básica de Cypress</a></li>
            <li class="list-group-item"><a href="#primer-test">Primer Archivo de Prueba (creación de venta)</a></li>
          </ol>
        </div>
        <div class="col-lg-6">
          <ol start="6" class="list-group list-group-numbered">
            <li class="list-group-item"><a href="#mas-casos">Más Casos de Prueba (validaciones y errores)</a></li>
            <li class="list-group-item"><a href="#reportes">Reportes Automáticos con Mochawesome</a></li>
            <li class="list-group-item"><a href="#estructura">Estructura de Carpetas, Fixtures y Support</a></li>
            <li class="list-group-item"><a href="#flujo-trabajo">Flujo de Trabajo y Scripts (CI/CD opcional)</a></li>
            <li class="list-group-item"><a href="#tips">Tips importantes para Cypress</a></li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <!-- ¿Qué es Cypress? -->
  <section id="cypress-que-es" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-info-circle section-icon"></i>
        ¿Qué es Cypress?
      </h2>
      <p class="fs-5 mb-4">
        <strong>Cypress</strong> es una herramienta moderna para <strong>automatizar pruebas de aplicaciones web</strong>. 
        Está pensada especialmente para frameworks como React, Vue o Angular, y permite realizar pruebas de extremo a extremo (E2E), de integración e incluso pruebas unitarias para componentes.
      </p>
      <h6 class="mt-4 mb-3">Características principales</h6>
      <div class="row">
        <div class="col-md-6">
          <ul class="list-unstyled">
            <li class="mb-2"><i class="fas fa-eye text-success me-2"></i>Pruebas en tiempo real (vista interactiva en el navegador)</li>
            <li class="mb-2"><i class="fas fa-code text-primary me-2"></i>Fácil de aprender (JavaScript o TypeScript)</li>
            <li class="mb-2"><i class="fas fa-camera text-warning me-2"></i>Capturas y videos automáticos (evidencia de pruebas)</li>
          </ul>
        </div>
        <div class="col-md-6">
          <ul class="list-unstyled">
            <li class="mb-2"><i class="fas fa-cogs text-info me-2"></i>Integración continua (GitHub Actions, Jenkins, GitLab)</li>
            <li class="mb-2"><i class="fas fa-bug text-danger me-2"></i>Debugging sencillo con inspección del DOM</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Esquema de Caja Negra -->
  <section id="esquema-caja-negra" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-cube section-icon"></i>
        Esquema de prueba de caja negra
      </h2>
      <p>
        <span class="badge bg-primary badge-step">Objetivo</span> 
        Validar que el módulo de <strong>Venta de Cursos</strong> cumpla con los requisitos funcionales sin analizar su código interno, asegurando que entradas, procesos y salidas se comporten según lo esperado.
      </p>
      <p>
        <span class="badge bg-secondary badge-step">Criterios a evaluar</span> 
        Creación, validaciones de campos, manejo de errores, cancelación de acciones y visualización de detalles.
      </p>

      <div class="table-responsive mt-4">
        <table class="table table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th><i class="fas fa-hashtag me-2"></i>ID</th>
              <th><i class="fas fa-cog me-2"></i>Funcionalidad</th>
              <th><i class="fas fa-sign-in-alt me-2"></i>Entrada</th>
              <th><i class="fas fa-play me-2"></i>Acción esperada</th>
              <th><i class="fas fa-check-circle me-2"></i>Resultado esperado</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>TC-01</td><td>Crear venta válida</td><td>Datos completos y válidos</td><td>Enviar formulario</td><td>Éxito y visualización en la lista</td></tr>
            <tr><td>TC-02</td><td>Crear venta sin beneficiario</td><td>Beneficiario vacío</td><td>Enviar formulario</td><td>Error indicando selección obligatoria</td></tr>
            <tr><td>TC-03</td><td>Crear venta sin curso</td><td>Curso vacío</td><td>Enviar formulario</td><td>Error indicando curso obligatorio</td></tr>
            <tr><td>TC-04</td><td>Validar número de clases</td><td>Número inválido (>720)</td><td>Enviar formulario</td><td>Error de validación de clases</td></tr>
            <tr><td>TC-05</td><td>Cancelar creación</td><td>Modal abierto</td><td>Presionar cancelar</td><td>Modal se cierra sin guardar</td></tr>
            <tr><td>TC-06</td><td>Ver detalles</td><td>Venta existente</td><td>Abrir detalles</td><td>Modal con información correcta</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Informe Paso a Paso -->
  <section id="informe-paso-a-paso" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-clipboard-list section-icon"></i>
        Informe del proceso paso a paso
      </h2>

      <div class="accordion" id="informeAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="f1">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#c1" aria-expanded="true">
              <i class="fas fa-preparation me-2"></i>Fase 1 – Preparación
            </button>
          </h2>
          <div id="c1" class="accordion-collapse collapse show" data-bs-parent="#informeAccordion">
            <div class="accordion-body">
              <ul>
                <li><strong>Definición de alcance:</strong> Validar funcionalidades principales del flujo de ventas.</li>
                <li><strong>Ambiente:</strong> Entorno local con base de datos de prueba y navegador Chrome.</li>
                <li><strong>Datos de prueba:</strong> Beneficiarios ficticios, cursos disponibles y ventas simuladas.</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="f2">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c2">
              <i class="fas fa-play me-2"></i>Fase 2 – Ejecución (Ejemplo TC-01)
            </button>
          </h2>
          <div id="c2" class="accordion-collapse collapse" data-bs-parent="#informeAccordion">
            <div class="accordion-body">
              <ol>
                <li>Ingresar al módulo de ventas.</li>
                <li>Presionar <em>"Crear Nuevo"</em>.</li>
                <li>Seleccionar beneficiario y curso.</li>
                <li>Ingresar número de clases válido y guardar.</li>
                <li>Verificar que la nueva venta aparezca en la lista con mensaje de éxito.</li>
              </ol>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="f3">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c3">
              <i class="fas fa-clipboard-check me-2"></i>Fase 3 – Registro de resultados
            </button>
          </h2>
          <div id="c3" class="accordion-collapse collapse" data-bs-parent="#informeAccordion">
            <div class="accordion-body">
              <ul>
                <li>Control por caso: fecha/hora, usuario, esperado vs real.</li>
                <li>Evidencia: capturas y/o videos.</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="f4">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c4">
              <i class="fas fa-flag-checkered me-2"></i>Fase 4 – Conclusión y acciones
            </button>
          </h2>
          <div id="c4" class="accordion-collapse collapse" data-bs-parent="#informeAccordion">
            <div class="accordion-body">
              <ul>
                <li><strong>Defectos ejemplo:</strong> validación de campos obligatorios; manejo de errores de conexión.</li>
                <li><strong>Acciones:</strong> ajustar validaciones y mejorar feedback visual al usuario.</li>
                <li><strong>Beneficios de automatizar:</strong> menos tiempo, más cobertura, evidencia automática.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Instalación -->
  <section id="instalacion" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-download section-icon"></i>
        Instalación básica de Cypress
      </h2>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-install">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-install" class="language-bash">npm install cypress --save-dev
npx cypress open</code></pre>
      </div>
    </div>
  </section>

  <!-- Primer test -->
  <section id="primer-test" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-code section-icon"></i>
        Primer archivo de prueba (creación de venta)
      </h2>
      <p class="text-muted">Ruta sugerida: <code class="text-primary">cypress/e2e/venta_cursos.cy.js</code></p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-first-test">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-first-test" class="language-javascript">describe('Módulo Venta de Cursos', () => {
  beforeEach(() => {
    // Interceptar las llamadas a la API para mejorar la estabilidad de las pruebas
    cy.intercept('GET', '**/api/beneficiarios*').as('getBeneficiarios');
    cy.intercept('GET', '**/api/cursos*').as('getCursos');
    cy.intercept('GET', '**/api/ventas/next-consecutivo').as('getConsecutivo');
    cy.intercept('POST', '**/api/ventas').as('createVenta');
    cy.intercept('GET', '**/api/ventas').as('getVentas');
    
    // Login previo en beforeEach para evitar repetición
    cy.visit('http://localhost:5173');
    cy.get('input[type="email"]', { timeout: 45000 }).should('be.visible').type('raulguzmaz1023@gmail.com');
    cy.get('input[type="password"]').type('raul444');
    cy.contains('INICIAR SESIÓN').click();
    
    cy.wait(30000);

    // Esperar a que complete el login y navegar a la página
    cy.url({ timeout: 45000 }).should('not.include', 'login');
    cy.visit('http://localhost:5173/venta-servicios/venta-cursos');
    
    cy.wait(30000);

    // Esperar a que cargue la página de ventas
    cy.wait('@getVentas', { timeout: 45000 });
    cy.contains('Venta de Cursos', { timeout: 45000 }).should('be.visible');
  });

    
  it('Debe crear una venta válida', () => {
    // Buscar el botón de crear usando un selector más específico basado en el código
    cy.get('[data-testid="create-button"], button').contains('Crear').click();
    
    // Verificar que el modal se abrió
    cy.contains('Crear Venta de Curso', { timeout: 25000 }).should('be.visible');
    
    // Esperar a que carguen los datos iniciales
    cy.wait(['@getBeneficiarios', '@getCursos', '@getConsecutivo'], { timeout: 35000 });
    
    // Seleccionar beneficiario usando el componente Autocomplete de Material-UI
    cy.get('input[placeholder*="beneficiario"], label').contains('Beneficiario').parent()
      .find('input').first().click().type('Juan{downArrow}{enter}', { delay: 100 });
    
    // Esperar un momento para que se cargue la información del cliente
    cy.wait(3000);
    
    // Seleccionar curso
    cy.get('label').contains('Curso').parent()
      .find('input').first().click().type('Guitarra{downArrow}{enter}', { delay: 100 });
    
    // Esperar a que se calcule el valor por hora
    cy.wait(2000);
    
    // Ingresar número de clases
    cy.get('label').contains('Número de Clases').parent().find('input[type="number"]')
      .clear().type('10');
    
    // Esperar a que se calcule el valor total
    cy.wait(2000);
    
    // Manejar las fechas usando el DatePicker de Material-UI
    // Para la fecha de inicio, usaremos la fecha actual
    const today = new Date();
    const todayFormatted = today.toISOString().split('T')[0]; // YYYY-MM-DD format
    
    // Buscar el campo de fecha por su label y usar setValue para evitar problemas del DatePicker
    cy.get('label').contains('Fecha Inicio').parent().find('input')
      .clear().type(todayFormatted);
    
    // Verificar que la fecha fin se estableció automáticamente
    cy.get('label').contains('Fecha Fin').parent().find('input')
      .should('not.have.value', '');

    
    // Hacer clic en crear venta
    cy.contains('button', 'Crear Venta').should('be.enabled').click();
    cy.wait(30000);
    // Esperar a que se complete la creación
    cy.wait('@createVenta', { timeout: 45000 });
        
    // Verificar que se actualiza la tabla
    cy.wait('@getVentas', { timeout: 25000 });
    cy.get('table, .MuiDataGrid-root').should('be.visible');
  });
});</code></pre>
      </div>
    </div>
  </section>

  <!-- Más casos -->
  <section id="mas-casos" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-tasks section-icon"></i>
        Más casos de prueba Cypress
      </h2>

      <h6 class="mt-4 mb-3">
        <i class="fas fa-times-circle text-danger me-2"></i>
        1) Validar error sin beneficiario
      </h6>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-sin-beneficiario">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-sin-beneficiario" class="language-javascript">it('Debe mostrar error al intentar crear una venta sin beneficiario', () => {
  // Abrir modal de creación
  cy.get('button').contains('Crear').click();
  
  // Verificar que el modal se abrió
  cy.contains('Crear Venta de Curso', { timeout: 25000 }).should('be.visible');
  
  // Esperar a que carguen los datos
  cy.wait(['@getBeneficiarios', '@getCursos', '@getConsecutivo'], { timeout: 35000 });
  
  // Intentar crear sin seleccionar beneficiario
  cy.contains('button', 'Crear Venta').click();
  
  // Verificar mensaje de error específico del componente
  cy.contains('Debe seleccionar un beneficiario', { timeout: 25000 }).should('be.visible');
  
  // Verificar que el modal sigue abierto
  cy.contains('Crear Venta de Curso').should('be.visible');
});</code></pre>
      </div>

      <h6 class="mt-4 mb-3">
        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
        2) Validar error sin curso
      </h6>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-sin-curso">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-sin-curso" class="language-javascript">it('Debe mostrar error al intentar crear una venta sin curso', () => {
  // Abrir modal de creación
  cy.get('button').contains('Crear').click();
  
  // Verificar que el modal se abrió
  cy.contains('Crear Venta de Curso', { timeout: 25000 }).should('be.visible');
  
  // Esperar a que carguen los datos
  cy.wait(['@getBeneficiarios', '@getCursos', '@getConsecutivo'], { timeout: 35000 });
  
  // Seleccionar solo beneficiario
  cy.get('label').contains('Beneficiario').parent()
    .find('input').first().click().type('Juan{downArrow}{enter}', { delay: 100 });
  
  // Intentar crear sin curso
  cy.contains('button', 'Crear Venta').click();
  
  // Verificar mensaje de error
  cy.contains('Debe seleccionar un curso', { timeout: 25000 }).should('be.visible');
});</code></pre>
      </div>

      <h6 class="mt-4 mb-3">
        <i class="fas fa-calculator text-info me-2"></i>
        3) Validar número de clases inválido
      </h6>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-clases-invalidas">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-clases-invalidas" class="language-javascript">it('Debe mostrar error con número de clases inválido', () => {
  // Abrir modal de creación
  cy.get('button').contains('Crear').click();
  
  // Verificar que el modal se abrió
  cy.contains('Crear Venta de Curso', { timeout: 25000 }).should('be.visible');
  
  // Esperar a que carguen los datos
  cy.wait(['@getBeneficiarios', '@getCursos', '@getConsecutivo'], { timeout: 35000 });
  
  // Seleccionar beneficiario y curso
  cy.get('label').contains('Beneficiario').parent()
    .find('input').first().click().type('Juan{downArrow}{enter}', { delay: 100 });
  
  cy.get('label').contains('Curso').parent()
    .find('input').first().click().type('Guitarra{downArrow}{enter}', { delay: 100 });
  
  // Ingresar número de clases inválido (mayor a 720)
  cy.get('label').contains('Número de Clases').parent().find('input[type="number"]')
    .clear().type('800');
  
  // Intentar crear venta
  cy.contains('button', 'Crear Venta').click();
  
  // Verificar mensaje de error
  cy.contains('Debe ingresar un número válido de clases', { timeout: 25000 }).should('be.visible');
});</code></pre>
      </div>

      <h6 class="mt-4 mb-3">
        <i class="fas fa-ban text-secondary me-2"></i>
        4) Cancelar creación de venta
      </h6>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-cancelar">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-cancelar" class="language-javascript">it('Debe cancelar la creación de venta', () => {
  // Abrir modal de creación
  cy.get('button').contains('Crear').click();
  
  // Verificar que el modal se abrió
  cy.contains('Crear Venta de Curso', { timeout: 25000 }).should('be.visible');
  
  // Hacer clic en cancelar
  cy.contains('button', 'Cancelar').click();
  
  // Verificar que el modal se cerró
  cy.contains('Crear Venta de Curso').should('not.exist');
  
  // Verificar que seguimos en la página principal
  cy.contains('Venta de Cursos').should('be.visible');
});</code></pre>
      </div>

      <h6 class="mt-4 mb-3">
        <i class="fas fa-eye text-primary me-2"></i>
        5) Ver detalles de una venta
      </h6>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-ver-detalles">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-ver-detalles" class="language-javascript">it('Debe mostrar detalles de una venta existente', () => {
  // Esperar a que cargue la tabla con datos
  cy.wait('@getVentas', { timeout: 30000 });
  
  // Buscar una fila en la tabla y hacer clic en el botón de ver detalles
  cy.get('table tbody tr, .MuiDataGrid-row').first().within(() => {
    cy.get('button[title*="Ver"], button').contains('Ver', { matchCase: false }).click();
  });
  
  // Verificar que se abre el modal de detalles
  cy.contains('Detalle de la Venta', { timeout: 25000 }).should('be.visible');
  
  // Verificar que se muestran los campos de detalle
  cy.contains('Beneficiario').should('be.visible');
  cy.contains('Curso').should('be.visible');
  cy.contains('Valor Total').should('be.visible');
  
  // Cerrar modal
  cy.get('button').contains('Cerrar', { matchCase: false }).click();
  
  // Verificar que el modal se cerró
  cy.contains('Detalle de la Venta').should('not.exist');
});</code></pre>
      </div>
    </div>
  </section>

  <!-- Reportes -->
  <section id="reportes" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-chart-bar section-icon"></i>
        Reportes automáticos con Mochawesome
      </h2>

      <p class="mb-3">
        <i class="fas fa-download text-primary me-2"></i>
        <strong>Instalar dependencias:</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-install-report">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-install-report" class="language-bash">npm install --save-dev mochawesome mochawesome-merge mochawesome-report-generator</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-cog text-warning me-2"></i>
        <strong>Configurar <code>cypress.config.js</code>:</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-config">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-config" class="language-javascript">const { defineConfig } = require('cypress')

module.exports = defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      // Eventos opcionales
    },
    reporter: 'mochawesome',
    reporterOptions: {
      reportDir: 'cypress/reports',
      overwrite: false,
      html: false,
      json: true
    }
  },
  video: true,
  screenshotOnRunFailure: true
})</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-play text-success me-2"></i>
        <strong>Ejecutar pruebas y generar reporte:</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-run-merge-generate">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-run-merge-generate" class="language-bash">npx cypress run
npx mochawesome-merge cypress/reports/*.json > cypress/reports/report.json
npx marge cypress/reports/report.json -f reporte-final -o cypress/reports</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-file-code text-info me-2"></i>
        <strong>Scripts en <code>package.json</code>:</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-scripts">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-scripts" class="language-json">"scripts": {
  "cypress:open": "cypress open",
  "cypress:run": "cypress run",
  "report:merge": "mochawesome-merge cypress/reports/*.json > cypress/reports/report.json",
  "report:generate": "marge cypress/reports/report.json -f reporte-final -o cypress/reports",
  "test:report": "npm run cypress:run && npm run report:merge && npm run report:generate"
}</code></pre>
      </div>
    </div>
  </section>

  <!-- Estructura -->
  <section id="estructura" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-folder-open section-icon"></i>
        Estructura de carpetas y archivos
      </h2>

      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-tree">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-tree" class="language-plaintext">/tu-proyecto
│
├── cypress
│   ├── e2e/
│   │   ├── venta_cursos.cy.js
│   │   └── otros_modulos.cy.js
│   ├── fixtures/
│   │   └── ejemplo.json
│   ├── support/
│   │   ├── commands.js
│   │   └── e2e.js
│   ├── reports/
│   │   ├── report.json
│   │   ├── reporte-final.html
│   │   └── reporte-final.pdf
│   ├── screenshots/
│   └── videos/
│
├── cypress.config.js
├── package.json
└── README.md</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-database text-primary me-2"></i>
        <strong>Fixture de ejemplo (<code>cypress/fixtures/ejemplo.json</code>):</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-fixture">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-fixture" class="language-json">{
  "beneficiario": "Juan Pérez",
  "curso": "Guitarra Básica",
  "clases": 10
}</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-magic text-warning me-2"></i>
        <strong>Uso en prueba:</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-fixture-use">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-fixture-use" class="language-javascript">cy.fixture('ejemplo').then((data) => {
  cy.get('input[label="Nombre Beneficiario"]').type(data.beneficiario);
});</code></pre>
      </div>

      <p class="mb-3 mt-4">
        <i class="fas fa-terminal text-success me-2"></i>
        <strong>Comandos personalizados (<code>cypress/support/commands.js</code>):</strong>
      </p>
      <div class="position-relative code-block rounded">
        <button class="btn btn-sm copy-btn" data-copy-target="#code-commands">
          <i class="fas fa-copy me-1"></i>Copiar
        </button>
        <pre><code id="code-commands" class="language-javascript">Cypress.Commands.add('login', (usuario, password) => {
  cy.visit('http://localhost:5173/login');
  cy.get('#usuario').type(usuario);
  cy.get('#password').type(password);
  cy.contains('Ingresar').click();
});</code></pre>
      </div>
    </div>
  </section>

  <!-- Flujo de trabajo -->
  <section id="flujo-trabajo" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-workflow section-icon"></i>
        Flujo de trabajo recomendado
      </h2>
      <div class="row">
        <div class="col-md-6">
          <ol class="list-unstyled">
            <li class="mb-3">
              <span class="badge bg-primary me-2">1</span>
              <i class="fas fa-eye text-primary me-2"></i>
              Ejecutar pruebas manuales (modo visual): <code class="text-info">npm run cypress:open</code>
            </li>
            <li class="mb-3">
              <span class="badge bg-secondary me-2">2</span>
              <i class="fas fa-robot text-secondary me-2"></i>
              Ejecutar pruebas automáticas con reporte: <code class="text-info">npm run test:report</code>
            </li>
          </ol>
        </div>
        <div class="col-md-6">
          <ol class="list-unstyled" start="3">
            <li class="mb-3">
              <span class="badge bg-success me-2">3</span>
              <i class="fas fa-file-alt text-success me-2"></i>
              Abrir el reporte: <code class="text-info">cypress/reports/reporte-final.html</code>
            </li>
            <li class="mb-3">
              <span class="badge bg-warning me-2">4</span>
              <i class="fas fa-cloud text-warning me-2"></i>
              (Opcional) Integrar en CI/CD para validar antes de cada despliegue.
            </li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <!-- Tips -->
  <section id="tips" class="mb-5">
    <div class="card p-4">
      <h2 class="section-title h4">
        <i class="fas fa-lightbulb section-icon"></i>
        Tips importantes para Cypress
      </h2>
      <div class="row">
        <div class="col-md-6">
          <ul class="list-unstyled">
            <li class="mb-3">
              <i class="fas fa-clock text-warning me-2"></i>
              Evita abusar de <code>cy.wait()</code>; Cypress sincroniza automáticamente.
            </li>
            <li class="mb-3">
              <i class="fas fa-database text-info me-2"></i>
              Mantén datos semilla: al menos una venta vigente y otra anulada.
            </li>
          </ul>
        </div>
        <div class="col-md-6">
          <ul class="list-unstyled">
            <li class="mb-3">
              <i class="fas fa-anchor text-primary me-2"></i>
              Usa selectores estables (data-testid) para mayor resiliencia.
            </li>
            <li class="mb-3">
              <i class="fas fa-camera text-success me-2"></i>
              Guarda evidencia (videos y screenshots) para auditoría.
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <footer class="py-4 text-center border-top">
    <div class="container">
      <p class="mb-3 fs-5">
        <i class="fas fa-rocket text-primary me-2"></i>
        Guía completa de Caja Negra + Cypress para el desarrollo de aplicaciones web
      </p>
      <div class="d-flex justify-content-center gap-3">
        <a href="#inicio" class="btn btn-outline-primary">
          <i class="fas fa-arrow-up me-1"></i>Volver arriba
        </a>
        <a href="https://cypress.io" target="_blank" class="btn btn-outline-secondary">
          <i class="fas fa-external-link-alt me-1"></i>Documentación Cypress
        </a>
      </div>
    </div>
  </footer>
</main>

<!-- Bootstrap JS + Highlight.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<script>
  // Copy-to-clipboard for each code block
  document.querySelectorAll('.copy-btn').forEach(function(btn){
    btn.addEventListener('click', function(){
      const target = document.querySelector(btn.getAttribute('data-copy-target'));
      if (!target) return;
      const text = target.innerText;
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check me-1"></i>¡Copiado!';
        btn.classList.remove('btn-outline-secondary');
        btn.classList.add('btn-success');
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.classList.remove('btn-success');
          btn.classList.add('btn-outline-secondary');
        }, 2000);
      }).catch(() => {
        btn.innerHTML = '<i class="fas fa-times me-1"></i>Error';
        btn.classList.add('btn-danger');
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.classList.remove('btn-danger');
        }, 2000);
      });
    });
  });

  // Smooth scroll enhancement
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });

  // Add loading animation to cards
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, observerOptions);

  // Observe all cards and sections for animations
  document.querySelectorAll('.card, section').forEach(el => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(30px)';
    el.style.transition = 'all 0.6s ease-out';
    observer.observe(el);
  });

  // Initialize first section as visible
  setTimeout(() => {
    document.querySelector('#inicio .card, #inicio section')?.style.setProperty('opacity', '1');
    document.querySelector('#inicio .card, #inicio section')?.style.setProperty('transform', 'translateY(0)');
  }, 100);
</script>
</body>
</html>